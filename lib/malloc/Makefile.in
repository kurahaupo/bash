# Skeleton Makefile for the GNU malloc code
#
# Copyright (C) 1996-2021 Free Software Foundation, Inc.

#   This program is free software: you can redistribute it and/or modify
#   it under the terms of the GNU General Public License as published by
#   the Free Software Foundation, either version 3 of the License, or
#   (at your option) any later version.

#   This program is distributed in the hope that it will be useful,
#   but WITHOUT ANY WARRANTY; without even the implied warranty of
#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#   GNU General Public License for more details.

#   You should have received a copy of the GNU General Public License
#   along with this program.  If not, see <http://www.gnu.org/licenses/>.

srcdir = @srcdir@
VPATH = @srcdir@
topdir = @top_srcdir@
BUILD_DIR = @BUILD_DIR@

INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA = @INSTALL_DATA@

CC = @CC@
RANLIB = @RANLIB@
AR = @AR@
ARFLAGS = @ARFLAGS@
RM = rm -f
CP = cp
MV = mv

SHELL = @MAKE_SHELL@

MKDEP = $(topdir)/support/mkdep

PROFILE_FLAGS = @PROFILE_FLAGS@

CFLAGS = @CFLAGS@
LOCAL_CFLAGS = @LOCAL_CFLAGS@
STYLE_CFLAGS = @STYLE_CFLAGS@
CPPFLAGS = @CPPFLAGS@
LDFLAGS = @LDFLAGS@

DEFS = @DEFS@
LOCAL_DEFS = @LOCAL_DEFS@

LIBBUILD = ${BUILD_DIR}/lib

BASHINCDIR = ${topdir}/include
SUPPORT_SRC = $(topdir)/support/

INTL_LIBSRC = ${topdir}/lib/intl
INTL_BUILDDIR = ${LIBBUILD}/intl
INTL_INC = @INTL_INC@
LIBINTL_H = @LIBINTL_H@

MKDEP = $(SUPPORT_SRC)mkdep
MKDEP_CC = ${CC}
MKDEP_OPTS = -c ${MKDEP_CC} -P -S "$(srcdir)" -T "$(topdir)"
MKDEP_CCFLAGS = ${CCFLAGS}
MKDEP_CSOURCES = $(srcdir)/*.c # *.c

INCLUDES = -I. -I../.. -I$(topdir) -I$(BASHINCDIR) -I$(topdir)/lib $(INTL_INC)

CCFLAGS = ${PROFILE_FLAGS} ${INCLUDES} $(DEFS) $(LOCAL_DEFS) $(LOCAL_CFLAGS) \
	  $(CFLAGS) $(MALLOC_CFLAGS) $(STYLE_CFLAGS) $(CPPFLAGS)

.c.o:
	$(CC) $(CCFLAGS) -c $<

.s.o:
	$(CC) $(CCFLAGS) -c $<

MALLOC_SOURCE = malloc.c
STUB_SOURCE = stub.c

ALLOCA_SOURCE = alloca.c
ALLOCA_OBJECT = alloca.o

MALLOC_SRC = @MALLOC_SRC@
MALLOC = @MALLOC@
ALLOCA = @ALLOCA@

MALLOC_OBJS = malloc.o $(ALLOCA) trace.o stats.o table.o watch.o
STUB_OBJS = $(ALLOCA) stub.o

.PHONY:		malloc stubmalloc

all:		malloc

malloc: ${MALLOC_OBJS}
	${RM} libmalloc.a
	${AR} ${ARFLAGS} libmalloc.a ${MALLOC_OBJS}
	-test -n "$(RANLIB)" && $(RANLIB) libmalloc.a

stubmalloc: ${STUB_OBJS}
	${RM} libmalloc.a
	${AR} ${ARFLAGS} libmalloc.a ${STUB_OBJS}
	-test -n "$(RANLIB)" && $(RANLIB) libmalloc.a

alloca: ${ALLOCA}
	${RM} libmalloc.a
	${AR} ${ARFLAGS} libmalloc.a ${ALLOCA}
	-test -n "$(RANLIB)" && $(RANLIB) libmalloc.a

alloca.o:	$(srcdir)/$(ALLOCA_SOURCE)
	$(CC) $(CCFLAGS) -c $(srcdir)/$(ALLOCA_SOURCE)
	@- if test "$(ALLOCA_OBJECT)" != alloca.o ; then \
		mv $(ALLOCA_OBJECT) alloca.o >/dev/null 2>&1 ; \
	fi

mostlyclean clean:
	$(RM) *.o libmalloc.a

distclean realclean maintainer-clean: clean
	$(RM) Makefile

.PHONY: depends depend
depends depend:
	sh $(MKDEP) $(MKDEP_OPTS) -- $(MKDEP_CCFLAGS) $(MKDEP_CSOURCES)

#MKDEP-CUT-HERE

# C *.c source & *.h header dependencies (generated)

alloca.o: $(BUILD_DIR)/config.h
alloca.o: $(srcdir)/alloca.c
alloca.o: $(topdir)/config-bot.h
alloca.o: $(topdir)/config-top.h
malloc.o: $(BUILD_DIR)/config.h
malloc.o: $(srcdir)/getpagesize.h
malloc.o: $(srcdir)/imalloc.h
malloc.o: $(srcdir)/malloc.c
malloc.o: $(topdir)/bashintl.h
malloc.o: $(topdir)/bashtypes.h
malloc.o: $(topdir)/config-bot.h
malloc.o: $(topdir)/config-top.h
malloc.o: $(topdir)/include/gettext.h
malloc.o: $(topdir)/include/stdc.h
memtest.o: $(srcdir)/memtest.c
memtest.o: $(topdir)/bashansi.h
memtest.o: $(topdir)/include/ansi_stdlib.h
memtest.o: $(topdir)/include/stdc.h
memtest.o: $(topdir)/xmalloc.h
sbrk.o: $(BUILD_DIR)/config.h
sbrk.o: $(srcdir)/sbrk.c
sbrk.o: $(topdir)/config-bot.h
sbrk.o: $(topdir)/config-top.h
stats.o: $(BUILD_DIR)/config.h
stats.o: $(srcdir)/imalloc.h
stats.o: $(srcdir)/stats.c
stats.o: $(topdir)/bashintl.h
stats.o: $(topdir)/config-bot.h
stats.o: $(topdir)/config-top.h
stats.o: $(topdir)/include/gettext.h
stub.o: $(srcdir)/stub.c
table.o: $(BUILD_DIR)/config.h
table.o: $(srcdir)/imalloc.h
table.o: $(srcdir)/table.c
table.o: $(srcdir)/table.h
table.o: $(topdir)/bashintl.h
table.o: $(topdir)/config-bot.h
table.o: $(topdir)/config-top.h
table.o: $(topdir)/include/gettext.h
trace.o: $(BUILD_DIR)/config.h
trace.o: $(srcdir)/imalloc.h
trace.o: $(srcdir)/trace.c
trace.o: $(topdir)/bashintl.h
trace.o: $(topdir)/config-bot.h
trace.o: $(topdir)/config-top.h
trace.o: $(topdir)/include/gettext.h
watch.o: $(BUILD_DIR)/config.h
watch.o: $(srcdir)/imalloc.h
watch.o: $(srcdir)/watch.c
watch.o: $(topdir)/bashintl.h
watch.o: $(topdir)/config-bot.h
watch.o: $(topdir)/config-top.h
watch.o: $(topdir)/include/gettext.h
xmalloc.o: $(BUILD_DIR)/config.h
xmalloc.o: $(srcdir)/xmalloc.c
xmalloc.o: $(topdir)/config-bot.h
xmalloc.o: $(topdir)/config-top.h
xmalloc.o: $(topdir)/include/ansi_stdlib.h

OLD/gmalloc.o: $(BUILD_DIR)/config.h
OLD/gmalloc.o: $(srcdir)/OLD/gmalloc.c
OLD/gmalloc.o: $(topdir)/config-bot.h
OLD/gmalloc.o: $(topdir)/config-top.h
OLD/gmalloc.o: $(topdir)/include/stdc.h
OLD/ogmalloc.o: $(BUILD_DIR)/config.h
OLD/ogmalloc.o: $(srcdir)/OLD/ogmalloc.c
OLD/ogmalloc.o: $(topdir)/config-bot.h
OLD/ogmalloc.o: $(topdir)/config-top.h
OLD/old-nmalloc.o: $(BUILD_DIR)/config.h
OLD/old-nmalloc.o: $(srcdir)/OLD/old-nmalloc.c
OLD/old-nmalloc.o: $(topdir)/bashtypes.h
OLD/old-nmalloc.o: $(topdir)/config-bot.h
OLD/old-nmalloc.o: $(topdir)/config-top.h
OLD/omalloc.o: $(BUILD_DIR)/config.h
OLD/omalloc.o: $(srcdir)/OLD/omalloc.c
OLD/omalloc.o: $(topdir)/bashtypes.h
OLD/omalloc.o: $(topdir)/config-bot.h
OLD/omalloc.o: $(topdir)/config-top.h
