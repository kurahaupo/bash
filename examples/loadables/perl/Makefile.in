#
# Makefile for builtin perl interpreter
#
#
#   Copyright (C) 1998 Free Software Foundation, Inc.
#
#   This program is free software: you can redistribute it and/or modify
#   it under the terms of the GNU General Public License as published by
#   the Free Software Foundation, either version 3 of the License, or
#   (at your option) any later version.
#
#   This program is distributed in the hope that it will be useful,
#   but WITHOUT ANY WARRANTY; without even the implied warranty of
#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#   GNU General Public License for more details.
#
#   You should have received a copy of the GNU General Public License
#   along with this program.  If not, see <http://www.gnu.org/licenses/>.
#

# Include some boilerplate Gnu makefile definitions.
prefix = @prefix@
exec_prefix = @exec_prefix@

bindir = @bindir@
libdir = @libdir@
infodir = @infodir@
includedir = @includedir@

datarootdir = @datarootdir@

topdir = @top_srcdir@
BUILD_DIR = @BUILD_DIR@
srcdir = @srcdir@
VPATH = @srcdir@

@SET_MAKE@
CC = @CC@
RM = rm -f

SHELL = @MAKE_SHELL@

PERL5 = perl5

CFLAGS = @CFLAGS@

SUPPORT_SRC = $(topdir)/support/

#
# These values are generated for configure by ${topdir}/support/shobj-conf.
# If your system is not supported by that script, but includes facilities for
# dynamic loading of shared objects, please update the script and send the
# changes to bash-maintainers@gnu.org.
#
SHOBJ_CC = @SHOBJ_CC@
SHOBJ_CFLAGS = @SHOBJ_CFLAGS@
SHOBJ_LD = @SHOBJ_LD@
SHOBJ_LDFLAGS = @SHOBJ_LDFLAGS@
SHOBJ_XLDFLAGS = @SHOBJ_XLDFLAGS@
SHOBJ_LIBS = @SHOBJ_LIBS@
SHOBJ_STATUS = @SHOBJ_STATUS@

# Values used for compiling the perl files
PERL_LDOPTS = `${PERL5} -MExtUtils::Embed -e ldopts`
PERL_CFLAGS = ${CCFLAGS} `${PERL5} -MExtUtils::Embed -e ccopts`

SRC = bperl.c iperl.c perlxsi.c
OBJ = bperl.o iperl.o perlxsi.o

BUILTIN = bperl5

INC = -I. -I.. \
      -I$(BUILD_DIR) -I$(BUILD_DIR)/lib -I$(BUILD_DIR)/builtins \
	 -I$(topdir)    -I$(topdir)/lib    -I$(topdir)/builtins -I$(topdir)/include \


MKDEP = $(SUPPORT_SRC)mkdep
MKDEP_CC = $(CC)
MKDEP_OPTS = -c $(MKDEP_CC) -P -S "$(srcdir)" -T "$(topdir)"
MKDEP_CCFLAGS = $(CCFLAGS) $(INC)
MKDEP_CSOURCES = $(srcdir)/*.c # *.c

${BUILTIN}:	${OBJ}
	${RM} $@
	${SHOBJ_LD} ${SHOBJ_LDFLAGS} ${SHOBJ_XLDFLAGS} -o $@ ${OBJ} ${PERL_LDOPTS} ${SHOBJ_LIBS}

bperl.o:	bperl.c
	${RM} $@
	$(SHOBJ_CC) $(SHOBJ_CFLAGS) $(CFLAGS) $(INC) -c -o $@ ${srcdir}/bperl.c

iperl.o:	iperl.c
	${RM} $@
	$(SHOBJ_CC) ${SHOBJ_CFLAGS} $(PERL_CFLAGS) -c -o $@ ${srcdir}/iperl.c

perlxsi.c:
	${PERL5} -MExtUtils::Embed -e xsinit -- -o $@

perlxsi.o:	perlxsi.c
	${RM} $@
	${SHOBJ_CC} ${SHOBJ_CFLAGS} $(PERL_CFLAGS) -c -o $@ perlxsi.c

clean mostlyclean:
	${RM} ${OBJ}
	${RM} ${BUILTIN}

distclean maintainer-clean: clean
	${RM} perlxsi.c

.PHONY: depends depend
depends depend:
	$(SHELL) $(MKDEP) $(MKDEP_OPTS) -- $(MKDEP_CCFLAGS) $(MKDEP_CSOURCES)

$(topdir)/builtins.h:
	cd "$(@D)" && $(MAKE) $(MAKEFLAGS) $(@F)

#MKDEP-CUT-HERE
# C *.c source & *.h header dependencies (generated)

bperl.o: $(BUILD_DIR)/config.h
bperl.o: $(srcdir)/bperl.c
bperl.o: $(topdir)/alias.h
bperl.o: $(topdir)/array.h
bperl.o: $(topdir)/arrayfunc.h
bperl.o: $(topdir)/assoc.h
bperl.o: $(topdir)/bashansi.h
bperl.o: $(topdir)/bashjmp.h
bperl.o: $(topdir)/bashtypes.h
bperl.o: $(topdir)/builtins.h
bperl.o: $(topdir)/builtins/common.h
bperl.o: $(topdir)/command.h
bperl.o: $(topdir)/config-bot.h
bperl.o: $(topdir)/config-top.h
bperl.o: $(topdir)/conftypes.h
bperl.o: $(topdir)/dispose_cmd.h
bperl.o: $(topdir)/error.h
bperl.o: $(topdir)/externs.h
bperl.o: $(topdir)/general.h
bperl.o: $(topdir)/hashlib.h
bperl.o: $(topdir)/include/chartypes.h
bperl.o: $(topdir)/include/maxpath.h
bperl.o: $(topdir)/include/ocache.h
bperl.o: $(topdir)/include/posixjmp.h
bperl.o: $(topdir)/include/stdc.h
bperl.o: $(topdir)/include/unlocked-io.h
bperl.o: $(topdir)/make_cmd.h
bperl.o: $(topdir)/pathnames.h
bperl.o: $(topdir)/quit.h
bperl.o: $(topdir)/shell.h
bperl.o: $(topdir)/sig.h
bperl.o: $(topdir)/subst.h
bperl.o: $(topdir)/syntax.h
bperl.o: $(topdir)/unwind_prot.h
bperl.o: $(topdir)/variables.h
bperl.o: $(topdir)/xmalloc.h
iperl.o: $(srcdir)/iperl.c
